# Spec: Task-Based Git Hooks

## Overview

Deno-hooks should be **simple**: it installs git hooks that run deno tasks
defined in the user's `deno.json`.

## Key Principle

**The hooks should be self-contained shell scripts that don't reference
deno-hooks at all.**

## Configuration Format

### Minimal Config (deno-hooks.yml)

```yaml
hooks:
  pre-commit:
    - deno task fmt
    - deno task lint

  pre-push:
    - deno task test
```

That's it! Each hook is just a list of commands to run.

### Alternative: deno.json

Users can also configure hooks in their `deno.json`:

```json
{
  "tasks": {
    "fmt": "deno fmt",
    "lint": "deno lint",
    "test": "deno test -A"
  },
  "deno-hooks": {
    "pre-commit": [
      "deno task fmt",
      "deno task lint"
    ],
    "pre-push": [
      "deno task test"
    ]
  }
}
```

## Generated Hook Scripts

### Example: `.git/hooks/pre-commit`

```bash
#!/bin/sh
# Generated by deno-hooks - DO NOT EDIT
# To update, run: deno task hooks

set -e

deno task fmt
deno task lint

echo "✓ All hooks passed"
```

Key features:

- **Self-contained**: No reference to deno-hooks
- **Simple**: Just runs the commands in order
- **Fail-fast**: `set -e` stops on first error
- **Clear**: Shows success message

## Architecture Simplification

### What We Remove

- ❌ `src/run.ts` - No longer needed
- ❌ `src/executor.ts` - No longer needed
- ❌ `src/files.ts` - No longer needed (file filtering is git's job)
- ❌ Built-in hooks (`deno-fmt`, `deno-lint`, `deno-test`)
- ❌ File glob patterns
- ❌ `pass_filenames` logic
- ❌ File filtering

### What We Keep

- ✅ `src/install.ts` - Installs hooks (simplified)
- ✅ `src/config.ts` - Loads configuration (simplified)
- ✅ `src/mod.ts` - Main exports

## User Experience

### Installation

```bash
# Install deno-hooks
deno run -A jsr:@theswanfactory/deno-hooks
```

This:

1. Reads `deno-hooks.yml` or `deno.json` config
2. Generates self-contained shell scripts in `.git/hooks/`
3. Makes them executable

### Configuration

Users define their tasks in `deno.json`:

```json
{
  "tasks": {
    "fmt": "deno fmt --check",
    "lint": "deno lint",
    "test": "deno test -A",
    "test:integration": "deno run -A scripts/integration-test.ts"
  }
}
```

Then configure which tasks run on which hooks in `deno-hooks.yml`:

```yaml
hooks:
  pre-commit:
    - deno task fmt
    - deno task lint

  pre-push:
    - deno task test
    - deno task test:integration
```

### Customization

Users can run ANY command, not just deno tasks:

```yaml
hooks:
  pre-commit:
    - deno task fmt
    - deno task lint
    - npm run typecheck
    - ./scripts/validate.sh
```

## Benefits

1. **Simple**: No complex file filtering or built-in hooks
2. **Transparent**: Generated hooks are readable shell scripts
3. **Portable**: Hooks work without deno-hooks installed
4. **Flexible**: Users can run any command
5. **Debuggable**: Easy to see what's happening
6. **No Magic**: Just runs commands in order

## Migration Path

This is a **breaking change** from v0.2.x. We'll need to:

1. Bump to v1.0.0 (major version)
2. Update documentation
3. Provide migration guide for existing users

### Old Config (v0.2.x)

```yaml
hooks:
  pre-commit:
    - id: deno-fmt
      run: deno-fmt
      glob: "*.{ts,js}"
      pass_filenames: true
```

### New Config (v1.0.0)

```yaml
hooks:
  pre-commit:
    - deno fmt --check
```

Much simpler!
